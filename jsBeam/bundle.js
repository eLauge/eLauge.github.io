(()=>{"use strict";const t=class{constructor(){this.F_virtual=Array(4).fill(0)}L;K=[];ind=[];dofs=[];E;I;d=[];F=[];F_virtual;F_total;FF=[];FF_virtual=[];dd=[];FF_total=[];getDofs(){let t=2*this.ind[0],e=2*this.ind[0]+1,s=2*this.ind[1],i=2*this.ind[1]+1;this.dofs=[t,e,s,i]}getDisplacements(t){this.d=[];for(let e=0;e<this.dofs.length;e++)this.d.push(t[this.dofs[e]])}getDisplacementsV2(){this.dd=[];for(let t=0;t<model.loadCases.length;t++){this.dd.push(Array(4).fill(0));for(let e=0;e<this.dofs.length;e++)this.dd[t][e]=model.loadCases[t].u[this.dofs[e]]}}getForces(){this.F=numeric.dot(this.K,this.d),this.F_total=numeric.add(this.F,this.F_virtual),this.F_total[0]=this.F_total[0],this.F_total[1]=-this.F_total[1],this.F_total[2]=-this.F_total[2],this.F_total[3]=this.F_total[3]}getForcesV2(){this.FF=[],this.FF_total=[];for(let t=0;t<model.loadCases.length;t++)this.FF.push(numeric.dot(this.K,this.dd[t])),this.FF_total.push(numeric.add(this.FF[t],this.FF_virtual[t])),this.FF_total[t][0]=this.FF_total[t][0],this.FF_total[t][1]=-this.FF_total[t][1],this.FF_total[t][2]=-this.FF_total[t][2],this.FF_total[t][3]=this.FF_total[t][3]}},e=function(t){let e=model.activeLc;var s=document.getElementById("beam_plot").offsetWidth-60-60,i=d3.select("#chart_"+t).selectAll(".main"+t).data([0]);i.enter().append("svg").attr("width",s+60+60).attr("height",125).attr("overflow","hidden").append("g").attr("class","main"+t).attr("transform","translate(60,10)"),i.select((function(){return this.parentNode})).attr("width",s+60+60),i=d3.select(".main"+t);var n=d3.min(model.coordinates),a=d3.max(model.coordinates);const o=d3.format(".3r"),r=function(e){return"M"==t?Math.abs(e)<.001?"":o(e)+" kNm":"V"==t?Math.abs(e)<.001?"":o(e)+" kN":"u"==t?Math.abs(e)<1e-8?"":o(e)+" mm":"theta"==t?Math.abs(e)<1e-8?"":o(e)+" ":void 0};let l=[];for(let s=0;s<model.elements.length;s++){let i=model.coordinates[model.elements[s].ind[0]],n=model.coordinates[model.elements[s].ind[1]],a=0,o=0;"M"==t&&(a=model.elements[s].FF_total[e][1]/1e6,o=model.elements[s].FF_total[e][3]/1e6),"V"==t&&(a=model.elements[s].FF_total[e][0]/1e3,o=model.elements[s].FF_total[e][2]/1e3),"u"==t&&(a=model.elements[s].dd[e][0],o=model.elements[s].dd[e][2]),"theta"==t&&(a=model.elements[s].dd[e][1],o=model.elements[s].dd[e][3]);var d=new Object;d.x=i,d.d=a,l.push(d);var h=new Object;h.x=n,h.d=o,l.push(h)}let p=d3.max(l,(t=>t.d)),u=d3.maxIndex(l,(t=>t.d)),c=d3.min(l,(t=>t.d)),m=d3.minIndex(l,(t=>t.d));var f=d3.scaleLinear().domain([n,a]).range([0,s]),F=d3.scaleLinear().domain([c,p]).range([85,0]);"M"==t&&F.range([0,85]),d3.line().x((t=>f([t.x]))).y((t=>F(t.d)));const x=d3.area().x((t=>f([t.x]))).y1((t=>F(t.d))).y0(F(0)),g=i.selectAll(".pissvin").data([l]);g.enter().datum(l).append("path").attr("class","pissvin").attr("fill","black").attr("fill-opacity",.1).attr("stroke","black").attr("stroke-width",1).attr("d",x).attr("stroke-dasharray","0,0"),g.transition().duration(500).attr("d",x),g.exit().remove();const L=i.selectAll("#maxVal").data([p]);L.enter().append("text").attr("text-anchor","middle").attr("id","maxVal").attr("x",f(l[u].x)).attr("y",F(p)-2).text(r(p)).attr("font-size","10"),L.transition().duration(1e3).attr("x",f(l[u].x)).attr("y",F(p)-2).text(r(p));const v=i.selectAll("#minVal").data([c]);v.enter().append("text").attr("text-anchor","middle").attr("id","minVal").attr("x",f(l[m].x)).attr("y",F(c)+10).text(r(c)).attr("font-size","10"),v.transition().duration(1e3).attr("x",f(l[m].x)).attr("y",F(c)+10).text(r(c))},s=class{ind;id;pointLoads=[];dispLoads=[];F_virtual;F_external;F_total;F_internal;u;constructor(t){this.id=t}calculateLoadVector(){this.F_external=Array(model.numDOF).fill(0),this.F_virtual=Array(model.numDOF).fill(0);for(let t=0;t<this.pointLoads.length;t++)this.F_external[this.pointLoads[t].dofs[0]]+=this.pointLoads[t].appliedForce,this.F_external[this.pointLoads[t].dofs[1]]+=this.pointLoads[t].appliedMoment;for(let t=0;t<this.dispLoads.length;t++){let e=this.dispLoads[t].indices[0],s=this.dispLoads[t].indices[1],i=this.dispLoads[t].x0,n=this.dispLoads[t].x1,a=this.dispLoads[t].p0,o=this.dispLoads[t].p1;for(let t=e;t<s;t++){let e=[2*t,2*t+1,2*(t+1),2*(t+1)+1],s=model.coordinates[t],r=model.coordinates[t+1],l=r-s,d=a+(s-i)*(o-a)/(n-i),h=a+(r-i)*(o-a)/(n-i),p=l*(7*d+3*h)/20,u=l*(3*d+7*h)/20,c=l**2/10*(d/2+h/3),m=l**2/10*(d/3+h/2);this.F_virtual[e[0]]+=p,this.F_virtual[e[1]]+=c,this.F_virtual[e[2]]+=u,this.F_virtual[e[3]]-=m,model.elements[t].FF_virtual[this.ind][0]-=p,model.elements[t].FF_virtual[this.ind][1]-=c,model.elements[t].FF_virtual[this.ind][2]-=u,model.elements[t].FF_virtual[this.ind][3]+=m}}this.F_total=numeric.add(this.F_external,this.F_virtual)}},i=function(){let t=model.activeLc;var e={draw:function(t,e){let s=e/1.8,i=e/4;t.moveTo(-s/2,i),t.lineTo(s/2,i),t.lineTo(0,0),t.lineTo(-s/2,i),t.closePath();let n=(s-4)/2;for(let e=0;e<3;e++)t.moveTo(-s/2+n*e+4,i+2),t.arc(-s/2+2+n*e,i+2,2,0,7);let a=s/5;for(let n=0;n<5;n++)t.moveTo(-s/2+a*(n+1),i+4),t.lineTo(-s/2+a*n,e/2);t.moveTo(-s/2,i+4),t.lineTo(s/2,i+4)}},s={draw:function(t,e){let s=e/1.5,i=e/3;t.moveTo(-s/2,i),t.lineTo(s/2,i),t.lineTo(0,0),t.lineTo(-s/2,i),t.closePath();let n=s/5;for(let a=0;a<5;a++)t.moveTo(-s/2+n*(a+1),i),t.lineTo(-s/2+n*a,e/2)}},i={draw:function(t,e){t.moveTo(0,-e/2),t.lineTo(0,e/2);let s=e/10;t.moveTo(0,-e/2+1*s),t.lineTo(2*-s,-e/2+2*s),t.moveTo(0,-e/2+2*s),t.lineTo(2*-s,-e/2+3*s),t.moveTo(0,-e/2+3*s),t.lineTo(2*-s,-e/2+4*s),t.moveTo(0,-e/2+4*s),t.lineTo(2*-s,-e/2+5*s),t.moveTo(0,-e/2+5*s),t.lineTo(2*-s,-e/2+6*s),t.moveTo(0,-e/2+6*s),t.lineTo(2*-s,-e/2+7*s),t.moveTo(0,-e/2+7*s),t.lineTo(2*-s,-e/2+8*s),t.moveTo(0,-e/2+8*s),t.lineTo(2*-s,-e/2+9*s),t.moveTo(0,-e/2+9*s),t.lineTo(2*-s,-e/2+10*s)}};let n={draw:function(t,e){t.moveTo(e/2,0),t.arc(0,0,e/2,0,Math.PI)}};var a=d3.min(model.coordinates),o=d3.max(model.coordinates),r=document.getElementById("beam_plot").offsetWidth-60-60,l=160,d=d3.select("#beam_plot").selectAll(".main").data([0]);d.enter().append("svg").attr("width",r+60+60).attr("height",200).attr("overflow","hidden").append("g").attr("class","main").attr("transform","translate(60,10)"),d.select((function(){return this.parentNode})).attr("width",r+60+60),d=d3.select(".main");var h=d3.scaleLinear().domain([a,o]).range([0,r]);d.selectAll("#xAxis").data([0]).enter().append("g").attr("transform","translate(0,160)").attr("id","xAxis");var p=d3.scaleLinear().domain([0,1]).range([l,0]);const u=model.supports;function c(t){return"Pinned"==t?s:"Fixed"==t?i:"Roller"==t?e:void 0}function m(t){return"end"==t?-1:1}d.selectAll(".support").data(u).transition().delay(0).duration(1e3).attr("d",d3.symbol().type((function(t){return c(t.type)})).size(25)).attr("transform",(function(t){return"translate("+h(t.position)+","+p(.5)+")scale("+m(t.positionType)+",1)"})),d.selectAll(".support").data(u).enter().append("path").attr("d",d3.symbol().type((function(t){return c(t.type)})).size(25)).attr("fill","none").attr("stroke","black").attr("stroke-width",1).attr("transform",(function(t){return"translate("+h(t.position)+","+p(.5)+")scale("+m(t.positionType)+",1)"})).attr("class","support"),d.selectAll(".support").data(u).exit().remove();const f=d.selectAll("#beamLine").data([model]);f.enter().append("line").attr("x1",0).attr("y1",p(.5)).attr("x2",h(model.length)).attr("y2",p(.5)).attr("stroke","black").attr("id","beamLine"),f.transition().duration(1e3).attr("x1",0).attr("y1",p(.5)).attr("x2",h(model.length)).attr("y2",p(.5));const F=model.loadCases[t].pointLoads;var x=d3.max(F,(t=>Math.abs(t.appliedForce))),g=d3.max(model.supports,(e=>Math.abs(e.FF[t]))),L=(d3.max([x,g]),d3.scaleLinear().domain([-x,x]).range([l,0])),v=d3.scaleLinear().domain([-g,0]).range([l,l/1.5]),w=d.selectAll("defs").data([0]).enter().append("defs");w.selectAll("#arrowHead").data([0]).enter().append("marker").attr("id","arrowHead").attr("refX",8).attr("refY",2.5).attr("markerWidth",8).attr("markerHeight",5).attr("orient","auto").append("path").attr("d",d3.line()([[0,0],[8,2.5],[0,5]])).attr("stroke","black").attr("stroke-width",0),w.append("marker").attr("id","momentArrow").attr("refX",0).attr("refY",3.5).attr("markerWidth",10).attr("markerHeight",7).attr("orient","auto").append("polygon").attr("points","0 0, 10 3.5, 0 7");const y=d3.format(".3r"),_=function(t){let e=y(math.abs(t)/1e3)+" kN";return Math.abs(t)<.001?"":e},M=function(t){let e=y(math.abs(t)/1e6)+" kNm";return Math.abs(t)<.001?"":e};var b=d.selectAll(".ptLoad").data(F);b.enter().append("g").attr("class","ptLoad").append("line").attr("x1",(function(t){return h(t.position)})).attr("y1",(function(t){return L(-t.appliedForce)})).attr("x2",(function(t){return h(t.position)})).attr("y2",L(0)).attr("stroke","black").attr("stroke-width","1.25").attr("marker-end",(function(t){if(0!=t.appliedForce)return"url(#arrowHead)"})).attr("fill","none").attr("class","ptLoadArrow").select((function(){return this.parentNode})).append("text").attr("x",(function(t){return h(t.position)})).attr("y",(function(t){return L(-t.appliedForce)})).text((function(t){return _(t.appliedForce)})).attr("font-size","10").attr("class","ptLoadTx").select((function(){return this.parentNode})).append("path").attr("d",d3.symbol().type(n).size(30)).attr("fill","none").attr("stroke","black").attr("stroke-width",(function(t){return Math.abs(t.appliedMoment)>0?1.35:0})).attr("transform",(function(t){let e=h(t.position),s=1;return t.appliedMoment>0&&(s=-1),"translate("+e+","+p(.5)+")scale("+s+",1)rotate(-90)"})).attr("class","ptMArrow").attr("marker-end","url(#momentArrow)").select((function(){return this.parentNode})).append("text").attr("x",(function(t){return h(t.position)})).attr("y",(function(t){return p(.5)})).text((function(t){return M(t.appliedMoment)})).attr("font-size","10").attr("class","ptLoadTxM"),b.exit().remove(),b.select(".ptLoadArrow").transition().duration(500).ease(d3.easeCubic).attr("x1",(function(t){return h(t.position)})).attr("y1",(function(t){return L(-t.appliedForce)})).attr("x2",(function(t){return h(t.position)})).attr("y2",L(0)).attr("marker-end",(function(t){if(0!=t.appliedForce)return"url(#arrowHead)"})).select((function(){return this.parentNode})).select(".ptLoadTx").transition().duration(500).attr("x",(function(t){return h(t.position)})).attr("y",(function(t){return L(-t.appliedForce)})).text((function(t){return _(t.appliedForce)})).select((function(){return this.parentNode})).select(".ptMArrow").transition().duration(250).attr("stroke-width",(function(t){return Math.abs(t.appliedMoment)>0?1.35:0})).attr("transform",(function(t){let e=h(t.position),s=1;return t.appliedMoment>0&&(s=-1),"translate("+e+","+p(.5)+")scale("+s+",1)rotate(-90)"})).select((function(){return this.parentNode})).select(".ptLoadTxM").transition().duration(500).attr("x",(function(t){return h(t.position)})).attr("y",(function(t){return p(.5)})).text((function(t){return M(t.appliedMoment)}));const k=function(t){return y(t/1e3)+" kN"},T=function(t){return y(t/1e6)+" kNm"};var A=d.selectAll(".sup").data(model.supports);A.enter().append("g").attr("class","sup").append("line").attr("x1",(function(t){return h(t.position)})).attr("y1",(function(e){return e.FF[t]>0?v(-Math.abs(e.FF[t])):v(0)})).attr("x2",(function(t){return h(t.position)})).attr("y2",(function(e){return e.FF[t]>0?v(0):v(-Math.abs(e.FF[t]))})).attr("stroke","black").attr("stroke-width","1.25").attr("marker-end",(function(e){if(0!=e.FF[t])return"url(#arrowHead)"})).attr("fill","none").attr("class","supLine").select((function(){return this.parentNode})).append("text").attr("x",(function(t){return h(t.position)})).attr("y",(function(e){return v(-e.FF[t])})).text((function(e){return k(e.FF[t])})).attr("font-size","10").attr("class","supText").select((function(){return this.parentNode})).append("path").attr("d",d3.symbol().type(n).size(30)).attr("fill","none").attr("stroke","black").attr("stroke-width",(function(t){return"Fixed"==t.type?1.35:0})).attr("transform",(function(e){let s=h(e.position),i=1;return e.MM[t]>0&&(i=-1),"translate("+s+","+p(.25)+")scale("+i+",1)rotate(0)"})).attr("class","supMomentArrow").attr("marker-end","url(#momentArrow)").select((function(){return this.parentNode})).append("text").attr("x",(function(t){return h(t.position)})).attr("y",(function(t){return p(.35)})).text((function(e){return"Fixed"==e.type?T(e.MM[t]):""})).attr("font-size","10").attr("class","supTextM"),A.exit().remove(),A.select(".supLine").transition().duration(1e3).ease(d3.easeCubic).attr("x1",(function(t){return h(t.position)})).attr("y1",(function(e){return e.FF[t]>0?v(-Math.abs(e.FF[t])):v(0)})).attr("x2",(function(t){return h(t.position)})).attr("y2",(function(e){return e.FF[t]>0?v(0):v(-Math.abs(e.FF[t]))})).attr("marker-end",(function(e){if(0!=e.FF[t])return"url(#arrowHead)"})).select((function(){return this.parentNode})).select(".supText").transition().duration(1e3).ease(d3.easeCubic).attr("x",(function(t){return h(t.position)})).attr("y",(function(e){return v(-Math.abs(e.FF[t]))})).text((function(e){return k(e.FF[t])})).select((function(){return this.parentNode})).select(".supMomentArrow").attr("stroke-width",(function(t){return"Fixed"==t.type?1.35:0})).attr("transform",(function(e){let s=h(e.position),i=1;return e.MM[t]>0&&(i=-1),"translate("+s+","+p(.25)+")scale("+i+",1)rotate(0)"})).select((function(){return this.parentNode})).select(".supTextM").attr("x",(function(t){return h(t.position)})).attr("y",(function(t){return p(.35)})).text((function(e){return"Fixed"==e.type?T(e.MM[t]):""}));const D=model.loadCases[t].dispLoads;var C=d3.min(D,(t=>d3.min([t.p0,t.p1]))),N=d3.max(D,(t=>d3.max([t.p0,t.p1]))),K=d3.max([Math.abs(N),Math.abs(C)]),V=d3.scaleLinear().domain([2*-K,2*K]).range([l,0]);const I=function(t){return y(math.abs(t))+" kN/m"},O=d.selectAll(".dispLoad1").data(D);O.enter().append("g").attr("class","dispLoad1").append("line").attr("x1",(function(t){return h(t.x0)})).attr("y1",(function(t){return V(-t.p0)})).attr("x2",(function(t){return h(t.x0)})).attr("y2",V(0)).attr("stroke","black").attr("stroke-width","1").attr("marker-end",(function(t){if(0!=t.p0)return"url(#arrowHead)"})).attr("fill","none").attr("class","dispLoad1Arrow").select((function(){return this.parentNode})).append("text").text((function(t){return I(t.p0)})).attr("x",(function(t){return h(t.x0)})).attr("y",(function(t){return V(-t.p0)})).attr("font-size","10").attr("class","dispLoad1Tx"),O.exit().remove(),O.select(".dispLoad1Arrow").transition().duration(1e3).attr("x1",(function(t){return h(t.x0)})).attr("y1",(function(t){return V(-t.p0)})).attr("x2",(function(t){return h(t.x0)})).attr("y2",V(0)).attr("marker-end",(function(t){if(0!=t.p0)return"url(#arrowHead)"})).select((function(){return this.parentNode})).select(".dispLoad1Tx").transition().text((function(t){return I(t.p0)})).attr("x",(function(t){return h(t.x0)})).attr("y",(function(t){return V(-t.p0)}));const z=d.selectAll(".dispLoad2").data(D);z.enter().append("g").attr("class","dispLoad2").append("line").attr("x1",(function(t){return h(t.x1)})).attr("y1",(function(t){return V(-t.p1)})).attr("x2",(function(t){return h(t.x1)})).attr("y2",V(0)).attr("stroke","black").attr("stroke-width","1").attr("marker-end",(function(t){if(0!=t.p1)return"url(#arrowHead)"})).attr("fill","none").attr("class","dispLoad2Arrow").select((function(){return this.parentNode})).append("text").text((function(t){return I(t.p1)})).attr("x",(function(t){return h(t.x1)})).attr("y",(function(t){return V(-t.p1)})).attr("font-size","10").attr("class","dispLoad2Tx"),z.exit().remove(),z.select(".dispLoad2Arrow").transition().duration(1e3).attr("x1",(function(t){return h(t.x1)})).attr("y1",(function(t){return V(-t.p1)})).attr("x2",(function(t){return h(t.x1)})).attr("y2",V(0)).attr("marker-end",(function(t){if(0!=t.p1)return"url(#arrowHead)"})).select((function(){return this.parentNode})).select(".dispLoad2Tx").transition().text((function(t){return I(t.p1)})).attr("x",(function(t){return h(t.x1)})).attr("y",(function(t){return V(-t.p1)}));const P=d.selectAll(".dispLoad3").data(D);P.enter().append("line").attr("x1",(function(t){return h(t.x0)})).attr("y1",(function(t){return V(-t.p0)})).attr("x2",(function(t){return h(t.x1)})).attr("y2",(function(t){return V(-t.p1)})).attr("stroke","black").attr("stroke-width","1").attr("fill","none").attr("class","dispLoad3"),P.exit().remove(),P.transition().duration(1e3).attr("x1",(function(t){return h(t.x0)})).attr("y1",(function(t){return V(-t.p0)})).attr("x2",(function(t){return h(t.x1)})).attr("y2",(function(t){return V(-t.p1)}))},n=class{constructor(){}getIndices(){this.indices=[],this.dofs=[];for(let t=0;t<this.x.length;t++){let e=model.coordinates.findIndex((e=>e===this.x[t]));this.indices.push(e),this.dofs.push(2*e),this.dofs.push(2*e+1)}}},a=class extends n{indices=[];dofs=[];x0;x1;p0;p1;plotPts=[];constructor(t,e,s,i){super(),this.x0=t,this.x1=e,this.p0=s,this.p1=i}getIndices(){this.x=[this.x0,this.x1],super.getIndices()}parseStrings(){this.x0=parseInt(this.x0),isNaN(this.x0)&&(this.x0=0),this.x1=parseInt(this.x1),isNaN(this.x1)&&(this.x0=0),this.p0=parseFloat(this.p0),isNaN(this.p0)&&(this.p0=0),this.p1=parseFloat(this.p1),isNaN(this.p1)&&(this.p1=0)}},o=class extends n{index;indices;dofs=[];position;appliedForce;appliedMoment;F;M;constructor(t,e,s){super(),this.position=t,this.appliedForce=e,this.appliedMoment=s,this.x=[t]}getIndices(){super.getIndices()}parseStrings(){this.x[0]=parseInt(this.x[0]),isNaN(this.x[0])&&(this.x[0]=0),this.appliedForce=parseFloat(this.appliedForce),isNaN(this.appliedForce)&&(this.appliedForce=0),this.appliedMoment=parseFloat(this.appliedMoment),isNaN(this.appliedMoment)&&(this.appliedMoment=0),this.position=this.x[0]}},r=class{index;dofs=[];position;positionType;type;F;M;FF=[];MM=[];constructor(t,e){this.position=t,this.type=e}};let l=new s("lc0");l.pointLoads.push(new o(4500,-1e4,0)),l.dispLoads.push(new a(0,1e4,-10,-10));let d=new s("lc1");d.pointLoads.push(new o(5500,-5e3,0)),d.dispLoads.push(new a(0,9e3,-3,-11));var h=[];h[0]=new r(0,"Roller"),h[1]=new r(1e4,"Fixed"),h[2]=new r(5e3,"Pinned"),new o(4500,-1e4,0),new a(0,1e4,-10,-10);var p=new class{length;youngsModulus;momentOfInertia;numSupports;numPointLoads;numDistributedLoads;numDivisions;numDOF;numNodes;loadCases=[];supports;coordinates;K;Kred;Fi;Fe;F_virtual;F_external;F_total;uKnown=[];fKnown=[];elements=[];activeLc=0;createNodes(){let t=Math.ceil(this.length/this.numDivisions);this.coordinates=math.range(0,this.length,t,!1),this.coordinates=this.coordinates.toArray(),this.coordinates.push(this.length);for(let t=0;t<this.loadCases.length;t++){for(let e=0;e<this.loadCases[t].pointLoads.length;e++)this.coordinates.push(this.loadCases[t].pointLoads[e].position);for(let e=0;e<this.loadCases[t].dispLoads.length;e++)this.coordinates.push(this.loadCases[t].dispLoads[e].x0),this.coordinates.push(this.loadCases[t].dispLoads[e].x1)}for(let t=0;t<this.supports.length;t++)this.coordinates.push(this.supports[t].position);this.coordinates=this.coordinates.filter((function(t,e,s){return s.indexOf(t)===e})),this.coordinates.sort(((t,e)=>t-e)),this.numNodes=this.coordinates.length,this.numDOF=2*this.numNodes}createFullStiffnessMatrix(){this.elements=[];var e=this.youngsModulus,s=this.momentOfInertia;this.K=math.zeros(this.numDOF,this.numDOF,"sparse");for(let o=0;o<this.coordinates.length-1;o++){let r=math.range(2*o,2*(o+1)+2).toArray(),l=math.subset(this.K,math.index(r,r)),d=this.coordinates[o+1]-this.coordinates[o];var i=math.matrix([[12,6*d,-12,6*d],[6*d,4*d*d,-6*d,2*d*d],[-12,-6*d,12,-6*d],[6*d,2*d*d,-6*d,4*d*d]]),n=e*s/(d*d*d),a=math.multiply(n,i);let h=math.add(l,a);this.K=math.subset(this.K,math.index(r,r),h);let p=new t;p.ind=[o,o+1],p.K=a.toArray(),p.getDofs(),p.E=this.youngsModulus,p.I=this.momentOfInertia,p.L=d,this.elements.push(p)}}findUKnown(){this.uKnown=[],this.fKnown=[];for(let t=0;t<this.supports.length;t++)this.uKnown.push(this.supports[t].dofs),this.uKnown=this.uKnown.flat(),this.uKnown=this.uKnown.sort();this.fKnown=math.range(0,this.numDOF).toArray(),this.fKnown=this.fKnown.filter((t=>!this.uKnown.includes(t)))}doCalculations(){this.d=math.zeros(this.numDOF,1,"sparse"),this.Fe=math.zeros(this.numDOF,1),this.F_external=Array(this.numDOF).fill(0),this.F_virtual=Array(this.numDOF).fill(0);for(let t=0;t<this.pointLoads.length;t++){let e=math.subset(this.Fe,math.index(this.pointLoads[t].dofs,0)),s=math.matrix([[pointLoads[t].appliedForce],[pointLoads[t].appliedMoment]]),i=math.add(e,s);this.Fe=math.subset(this.Fe,math.index(this.pointLoads[t].dofs,0),i),this.F_external[this.pointLoads[t].dofs[0]]+=this.pointLoads[t].appliedForce,this.F_external[this.pointLoads[t].dofs[1]]+=this.pointLoads[t].appliedMoment}for(let t=0;t<this.dispLoads.length;t++){let e=this.dispLoads[t].indices[0],s=this.dispLoads[t].indices[1],i=this.dispLoads[t].x0,n=this.dispLoads[t].x1,a=this.dispLoads[t].p0,o=this.dispLoads[t].p1;this.coordinates[s],this.coordinates[e];for(let t=e;t<s;t++){let e=[2*t,2*t+1,2*(t+1),2*(t+1)+1],s=this.coordinates[t],r=this.coordinates[t+1],l=r-s,d=a+(s-i)*(o-a)/(n-i),h=a+(r-i)*(o-a)/(n-i),p=l*(7*d+3*h)/20,u=l*(3*d+7*h)/20,c=l**2/10*(d/2+h/3),m=l**2/10*(d/3+h/2);this.Fe._data[e[0]][0]+=p,this.Fe._data[e[1]][0]+=c,this.Fe._data[e[2]][0]+=u,this.Fe._data[e[3]][0]-=m,this.elements[t].F_virtual[0]-=p,this.elements[t].F_virtual[1]-=c,this.elements[t].F_virtual[2]-=u,this.elements[t].F_virtual[3]+=m,this.F_virtual[e[0]]-=p,this.F_virtual[e[1]]+=c,this.F_virtual[e[2]]-=u,this.F_virtual[e[3]]-=m}}this.F_total=numeric.sub(this.F_external,this.F_virtual),this.Fered=math.subset(this.Fe,math.index(this.fKnown,0)),this.Kred=math.subset(this.K,math.index(this.fKnown,this.fKnown));let t,e=this.Kred.toArray(),s=Date.now(),i=numeric.ccsSparse(this.Fered.toArray()),n=numeric.ccsSparse(e),a=numeric.ccsLUP(n),o=numeric.ccsLUPSolve(a,i),r=Date.now()-s;console.log("Solving with LU (sparse) took "+Math.floor(r)+" milliseconds with numericjs"),t=0==o[1].length?math.zeros(this.numDOF,1,"dense").toArray():math.subset(this.d.toArray(),math.index(this.fKnown,0),numeric.ccsFull(o)),this.finalDisplacements=t,this.verticalDisplacements=[];for(let t=0;t<this.finalDisplacements.length-1;t+=2)this.verticalDisplacements.push(this.finalDisplacements[t]);this.verticalDisplacements=this.verticalDisplacements.flat(),this.rotationalDisplacements=[];for(let t=0;t<this.finalDisplacements.length-1;t+=2)this.rotationalDisplacements.push(this.finalDisplacements[t+1]);this.rotationalDisplacements=this.rotationalDisplacements.flat(),this.u=t,this.Fi=math.multiply(this.K,this.u),this.Fi=math.subtract(this.Fi,this.Fe)}calculateForces(){for(let t=0;t<this.nodes.length-1;t++){let e=this.nodes[t+1].position-this.nodes[t].position,s=this.nodes[t].u,i=this.nodes[t].theta,n=this.nodes[t+1].u,a=this.nodes[t+1].theta,o=this.youngsModulus,r=this.momentOfInertia,l=o*r/e**3*(12*s+6*e*i-12*n+6*e*a),d=o*r/e**3*(-12*s-6*e*i+12*n-6*e*a),h=o*r/e**3*(6*e*s+4*e**2*i-6*e*n+2*e**2*a),p=o*r/e**3*(6*e*s+2*e**2*i-6*e*n+4*e**2*a),u=this.Fe._data[2*t+0][0],c=this.Fe._data[2*t+1][0],m=this.Fe._data[2*(t+1)+0][0],f=this.Fe._data[2*(t+1)+1][0];this.nodes[t].V=(l-u)/1e3,this.nodes[t].M=(-h+c)/1e6,this.nodes[t+1].V=(-d+m)/1e3,this.nodes[t+1].M=(p-f)/1e6}}fillNodeInformation(){this.nodes=[];for(let t=0;t<this.coordinates.length;t++){let e=new Node;e.index=t,e.position=this.coordinates[t],e.u=this.verticalDisplacements[t],e.theta=this.rotationalDisplacements[t],this.nodes.push(e)}}getReactionForces(){for(let t=0;t<this.supports.length;t++){if("Pinned"==this.supports[t].type||"Roller"==this.supports[t].type){let e=this.supports[t].dofs[0],s=this.Fi._data[e][0];this.supports[t].F=s}if("Fixed"==this.supports[t].type){let e=this.supports[t].dofs[0],s=this.supports[t].dofs[1],i=this.Fi._data[e][0],n=this.Fi._data[s][0];this.supports[t].F=i,this.supports[t].M=n}}}fillElementInformation(){let t=this.finalDisplacements.flat();for(let e=0;e<this.elements.length;e++)this.elements[e].getDisplacements(t),this.elements[e].getForces()}solveBeam(){window.model=this,this.resetModel(),this.createNodes(),this.coordinates[this.coordinates.length-1]>this.length?console.log("Beam length is shorter than applied loads or supports"):(this.assignIndicesV2(),this.createFullStiffnessMatrix(),this.findUKnown(),this.calculateExternalLoadVectors(),this.calculateDisplacements(),this.fillElementInformationV2(),this.getReactionForcesV2())}resetModel(){for(let t=0;t<this.elements.length;t++)this.elements[t].FF_virtual=[]}calculateExternalLoadVectors(){for(let t=0;t<this.loadCases.length;t++){for(let t=0;t<this.elements.length;t++)this.elements[t].FF_virtual.push(Array(4).fill(0));this.loadCases[t].calculateLoadVector()}}assignIndicesV2(){for(let t=0;t<this.loadCases.length;t++){this.loadCases[t].ind=t;for(let e=0;e<this.loadCases[t].pointLoads.length;e++)this.loadCases[t].pointLoads[e].getIndices();for(let e=0;e<this.loadCases[t].dispLoads.length;e++)this.loadCases[t].dispLoads[e].getIndices()}for(let e=0;e<this.supports.length;e++){var t=this.coordinates.findIndex((t=>t===this.supports[e].position));t==this.coordinates.length-1&&(this.supports[e].positionType="end"),0==t&&(this.supports[e].positionType="start"),console.log("Support index = "+t),this.supports[e].index=t,this.supports[e].dofs=[],"Pinned"!=this.supports[e].type&&"Roller"!=this.supports[e].type||this.supports[e].dofs.push(2*t),"Fixed"==this.supports[e].type&&(this.supports[e].dofs.push(2*t),this.supports[e].dofs.push(2*t+1))}}calculateDisplacements(){let t=this.K,e=[t._ptr,t._index,t._values],s=math.subset(t,math.index(this.fKnown,this.fKnown)),i=[s._ptr,s._index,s._values],n=numeric.ccsLUP(i);for(let t=0;t<this.loadCases.length;t++){let i=this.loadCases[t].F_total,a=this.fKnown.map((t=>[i[t]])),o=numeric.ccsSparse(a),r=numeric.ccsLUPSolve(n,o);r=0==r[1].length?math.zeros(s._size[0],1,"dense").toArray().flat():numeric.ccsFull(r).flat();let l=Array(this.numDOF).fill([Number.MIN_VALUE]);this.fKnown.forEach(((t,e)=>l[t]=[r[e]])),this.loadCases[t].u=l,this.loadCases[t].F_internal=numeric.ccsFull(numeric.ccsDot(e,numeric.ccsSparse(l))).flat(),this.loadCases[t].F_internal=numeric.sub(this.loadCases[t].F_internal,this.loadCases[t].F_virtual),this.loadCases[t].u=this.loadCases[t].u.flat()}}fillElementInformationV2(){for(let t=0;t<this.elements.length;t++)this.elements[t].getDisplacementsV2(),this.elements[t].getForcesV2()}getReactionForcesV2(){for(let t=0;t<this.supports.length;t++)this.supports[t].FF=[],this.supports[t].MM=[];for(let t=0;t<this.loadCases.length;t++)for(let e=0;e<this.supports.length;e++){if("Pinned"==this.supports[e].type||"Roller"==this.supports[e].type){let s=this.supports[e].dofs[0],i=this.loadCases[t].F_internal[s];this.supports[e].FF.push(i)}if("Fixed"==this.supports[e].type){let s=this.supports[e].dofs[0],i=this.supports[e].dofs[1],n=this.loadCases[t].F_internal[s],a=this.loadCases[t].F_internal[i];this.supports[e].FF.push(n),this.supports[e].MM.push(a)}}}};p.length=1e4,p.youngsModulus=21e4,p.momentOfInertia=204e6,p.supports=h,p.numDivisions=50,p.loadCases.push(l),p.loadCases.push(d),p.solveBeam(),e("V"),e("M"),e("theta"),e("u"),i(),document.getElementById("supportTable"),window.onresize=function(){e("V"),e("M"),e("theta"),e("u"),i()};const{createApp:u,reactive:c}=Vue,m=c({ptLoads:p.loadCases[0].pointLoads,dispLoads:p.loadCases[0].dispLoads,loadCases:p.loadCases,lc:0,supports:p.supports,showV:!0,showM:!0,showTheta:!1,showU:!0,numDivisions:p.numDivisions,length:p.length});function f(t){m.ptLoads=p.loadCases[t].pointLoads,m.dispLoads=p.loadCases[t].dispLoads,p.activeLc=t}Vue.createApp({data:()=>m,watch:{supports:{handler(t,s){console.log("Supports changed"),this.supports.forEach((t=>t.position=parseInt(t.position))),p.solveBeam(),i(),e("V"),e("M"),e("theta"),e("u")},deep:!0}},methods:{addSupport(){this.supports.push(new r(0,"Pinned"))},delSupport(t){this.supports.splice(t,1)}},computed:{}}).mount("#supTable"),Vue.createApp({data:()=>m,methods:{addLC(){this.loadCases.push(new s("new"))},delLC(t){this.loadCases.splice(t,1),this.lc==!this.loadCases.length||(this.lc=0),f(this.lc)}},computed:{tester(){f(this.lc)}}}).mount("#lcTable"),Vue.createApp({data:()=>m,watch:{ptLoads:{handler(t,s){console.log("Point loads changed"),this.ptLoads.forEach((t=>t.parseStrings())),p.solveBeam(),i(),e("V"),e("M"),e("theta"),e("u")},deep:!0}},methods:{delPointLoad(t){this.ptLoads.splice(t,1)},addPointLoad(){this.ptLoads.push(new o(0,0,0))}}}).mount("#pointLoadTable"),Vue.createApp({data:()=>m,watch:{dispLoads:{handler(t,s){console.log("Distributed loads changed"),this.dispLoads.forEach((t=>t.parseStrings())),p.solveBeam(),i(),e("V"),e("M"),e("theta"),e("u")},deep:!0}},methods:{addDispLoad(){this.dispLoads.push(new a(0,0,0,0))},delDispLoad(t){this.dispLoads.splice(t,1)}}}).mount("#dispLoadTable"),Vue.createApp({data:()=>m,methods:{}}).mount(".Results"),Vue.createApp({data:()=>m,watch:{numDivisions:function(t){p.numDivisions=parseInt(t),p.solveBeam(),i(),e("V"),e("M"),e("theta"),e("u")},length:function(t){p.length=parseInt(t),p.solveBeam(),i(),e("V"),e("M"),e("theta"),e("u")}}}).mount("#beamInput")})();